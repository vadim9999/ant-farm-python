(this["webpackJsonpant-farm-react"]=this["webpackJsonpant-farm-react"]||[]).push([[0],{251:function(e,t,n){},253:function(e,t,n){"use strict";n.r(t);var c,i=n(0),a=n.n(i),r=n(257),s=n(262),l=n(148),o=n(21),j=n(26),d=n(264),u=n(259),b=n(42),O=n(261),x=n(51),h=n(6),m=a.a.createContext({globalState:{isRecording:!1,isStartedPreview:!1,isStreaming:!1},dispatch:function(){}}),f=function(e){var t=e.children,n=Object(i.useReducer)((function(e,t){return Object(x.a)(Object(x.a)({},e),t)}),{isRecording:!1,isStartedPreview:!1,isStreaming:!1}),c=Object(j.a)(n,2),a=c[0],r=c[1],s=Object(i.useMemo)((function(){return{globalState:a,dispatch:r}}),[a,r]);return Object(h.jsx)(m.Provider,{value:s,children:t})},g=n(258),p=n(260),v=n(255),y=n(256);!function(e){e.Q720="1280x720",e.Q480="854x480",e.Q240="426x240"}(c||(c={}));var S=function(e){var t=e.onCancel,n=e.onSubmit,i=g.a.useForm(),a=Object(j.a)(i,1)[0],r="\u041d\u0430\u0437\u0432\u0430 \u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f",s="\u042f\u043a\u0456\u0441\u0442\u044c \u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f",l={quality:c.Q480};return Object(h.jsxs)(g.a,{form:a,name:"createPictureForm",initialValues:l,onFinish:n,children:[Object(h.jsx)(g.a.Item,{name:"filename",label:r,rules:[{required:!0,message:"\u0412\u0432\u0435\u0434\u0456\u0442\u044c \u043d\u0430\u0437\u0432\u0443 \u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f"}],children:Object(h.jsx)(p.a,{style:{width:400}})}),Object(h.jsx)(g.a.Item,{name:"quality",label:s,children:Object(h.jsxs)(u.a,{style:{width:120},children:[Object(h.jsx)(u.a.Option,{value:c.Q720,children:"1280x720"}),Object(h.jsx)(u.a.Option,{value:c.Q480,children:"854x480"}),Object(h.jsx)(u.a.Option,{value:c.Q240,children:"426x240"})]})}),Object(h.jsx)(g.a.Item,{children:Object(h.jsxs)(v.a,{justify:"space-between",children:[Object(h.jsx)(y.a,{xs:11,children:Object(h.jsx)(b.a,{type:"default",onClick:t,block:!0,children:"Cancel"})}),Object(h.jsx)(y.a,{xs:11,children:Object(h.jsx)(b.a,{type:"primary",htmlType:"submit",block:!0,children:"Submit"})})]})})]})},I=n(73),C=n.n(I),k="".concat(document.location.protocol,'"//"').concat(document.location.hostname,":8000"),w=function(e){return e.replace("?id=","")},Q=(u.a.Option,function(){var e=Object(i.useContext)(m).globalState,t=Object(o.f)(),n=Object(i.useState)(!1),c=Object(j.a)(n,2),a=c[0],r=c[1],s="\u0421\u0442\u0432\u043e\u0440\u0438\u0442\u0438 \u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f",l=w(t.search),u=function(){r(!1)};return Object(h.jsxs)("div",{children:[Object(h.jsx)(b.a,{type:"primary",icon:Object(h.jsx)(d.a,{}),onClick:function(){r(!0)},size:"large",disabled:!e.isStartedPreview,children:s}),Object(h.jsx)(O.a,{title:s,centered:!0,visible:a,footer:null,onCancel:u,destroyOnClose:!0,children:Object(h.jsx)(S,{onSubmit:function(e){!function(e){var t=e.resolution,n=e.filename,c=e.userId;C.a.post("".concat(k,"/capture_image?id=").concat(c),JSON.stringify({resolution:t,filename:n}))}({resolution:e.quality,filename:e.filename,userId:l}),r(!1)},onCancel:u})})]})}),R=n(265),F=n(266),P=function(e){var t=e.onCancel,n=e.onSubmit,i=g.a.useForm(),a=Object(j.a)(i,1)[0];return Object(h.jsxs)(g.a,{form:a,name:"streamingForm",onFinish:n,children:[Object(h.jsx)(g.a.Item,{name:"quality",label:"\u042f\u043a\u0456\u0441\u0442\u044c \u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f",children:Object(h.jsxs)(u.a,{style:{width:120},children:[Object(h.jsx)(u.a.Option,{value:c.Q720,children:"1280x720"}),Object(h.jsx)(u.a.Option,{value:c.Q480,children:"854x480"}),Object(h.jsx)(u.a.Option,{value:c.Q240,children:"426x240"})]})}),Object(h.jsx)(g.a.Item,{children:Object(h.jsxs)(v.a,{justify:"space-between",children:[Object(h.jsx)(y.a,{xs:11,children:Object(h.jsx)(b.a,{type:"default",onClick:t,block:!0,children:"Cancel"})}),Object(h.jsx)(y.a,{xs:11,children:Object(h.jsx)(b.a,{type:"primary",htmlType:"submit",block:!0,children:"Submit"})})]})})]})},T=(u.a.Option,function(){var e=Object(i.useContext)(m).globalState,t=Object(i.useState)(!1),n=Object(j.a)(t,2),c=n[0],a=n[1],r="\u041f\u043e\u0447\u0430\u0442\u0438 \u0442\u0440\u0430\u043d\u0441\u043b\u044f\u0446\u0456\u044e",s=function(){a(!1)};return Object(h.jsxs)("div",{children:[e.isStreaming?Object(h.jsx)(b.a,{type:"primary",danger:!0,icon:Object(h.jsx)(R.a,{}),size:"large",disabled:!0,children:"\u0417\u0443\u043f\u0438\u043d\u0438\u0442\u0438 \u0442\u0440\u0430\u043d\u0441\u043b\u044f\u0446\u0456\u044e"}):Object(h.jsx)(b.a,{type:"primary",icon:Object(h.jsx)(F.a,{}),disabled:!e.isStartedPreview,size:"large",children:r}),Object(h.jsx)(O.a,{title:r,centered:!0,visible:c,footer:null,onCancel:s,destroyOnClose:!0,children:Object(h.jsx)(P,{onSubmit:function(){a(!1)},onCancel:s})})]})}),q=n(263),z=n(267),N=n(268),E=(n(251),function(){var e=Object(i.useContext)(m),t=e.globalState,n=e.dispatch;console.log("globalContext",t);var a=Object(o.f)(),r=(Object(o.f)(),Object(i.useReducer)((function(e,t){return Object(x.a)(Object(x.a)({},e),t)}),{imageUrl:"",currentResolution:c.Q480})),l=Object(j.a)(r,2),d=l[0],u=l[1];console.log("location",w(a.search));var O=w(a.search),f=function(e){var t=e.resolution;return function(){(function(e){var t=e.userId,n=e.resolution;return C.a.post("".concat(k,"/start?id=").concat(t),n)})({userId:O,resolution:t}).then((function(){var e="".concat(k,"/stream.mjpg?id=").concat(O);u({imageUrl:e}),n({isStartedPreview:!0})}))}},g=function(){return function(e){var t=e.userId;return C.a.get("".concat(k,"/stop?id=").concat(t))}({userId:O}).then((function(){u({imageUrl:""}),n({isStartedPreview:!1})}))},p=Object(h.jsxs)(s.a,{selectedKeys:[d.currentResolution],onClick:function(e){t.isStartedPreview&&g().then((function(){setTimeout((function(){f({resolution:e.key})()}),1e3)})),console.log("e",e.key),u({currentResolution:e.key})},children:[Object(h.jsx)(s.a.Item,{children:"720 HD"},c.Q720),Object(h.jsx)(s.a.Item,{children:"480"},c.Q480),Object(h.jsx)(s.a.Item,{children:"240"},c.Q240)]});return Object(h.jsx)("div",{className:"videoPlayer",children:Object(h.jsxs)("div",{id:"fullScreen",children:[d.imageUrl&&Object(h.jsx)("img",{id:"badge",src:d.imageUrl,width:"640",height:"480",alt:"Video"}),Object(h.jsxs)("div",{className:"controls",children:[Object(h.jsxs)("div",{children:[Object(h.jsx)(b.a,{type:"primary",icon:Object(h.jsx)(F.a,{}),size:"large",onClick:f({resolution:d.currentResolution}),disabled:t.isStartedPreview||t.isRecording}),Object(h.jsx)(b.a,{type:"primary",danger:!0,icon:Object(h.jsx)(R.a,{}),size:"large",onClick:g,disabled:!t.isStartedPreview||t.isRecording})]}),Object(h.jsxs)("div",{children:[Object(h.jsx)(q.a,{overlay:p,disabled:t.isRecording,trigger:["click"],placement:"topCenter",children:Object(h.jsx)(b.a,{type:"primary",icon:Object(h.jsx)(z.a,{}),size:"large"})}),Object(h.jsx)(b.a,{type:"primary",icon:Object(h.jsx)(N.a,{}),size:"large",onClick:function(){var e,t=document.getElementById("fullScreen");if(null===t||void 0===t||t.webkitRequestFullScreen(),null===(e=document)||void 0===e?void 0:e.webkitFullscreenElement){document.webkitCancelFullScreen();var n=document.getElementById("badge");null===n||void 0===n||n.setAttribute("width","640"),null===n||void 0===n||n.setAttribute("height","480")}else{null===t||void 0===t||t.webkitRequestFullScreen();var c=document.getElementById("badge");null===c||void 0===c||c.setAttribute("width","100%"),null===c||void 0===c||c.setAttribute("height","100%")}}})]})]})]})})}),M=n(121),B=n.n(M),U=function(e){var t=e.onStopRecording,n=Object(i.useState)({startedTime:B()(),diffTimeInSeconds:0}),c=Object(j.a)(n,2),a=c[0],r=c[1];Object(i.useEffect)((function(){var e=setInterval((function(){r(Object(x.a)(Object(x.a)({},a),{},{diffTimeInSeconds:B()().diff(a.startedTime,"seconds")}))}),1e3);return function(){clearInterval(e)}}),[]);var s=Math.floor(a.diffTimeInSeconds/3600),l=Math.floor(a.diffTimeInSeconds/60)>=60?Math.floor(a.diffTimeInSeconds/60)-60*s:Math.floor(a.diffTimeInSeconds/60),o=a.diffTimeInSeconds-60*l;return Object(h.jsxs)(b.a,{type:"primary",danger:!0,icon:Object(h.jsx)(R.a,{}),size:"large",onClick:t,children:["\u0417\u0443\u043f\u0438\u043d\u0438\u0442\u0438 \u0437\u0430\u043f\u0438\u0441 ",(s<10?"0":"")+s,":",(l<10?"0":"")+l,":",(o<10?"0":"")+o]})},A=u.a.Option,J=function(e){var t=e.onSubmit,n=e.onCancel,i=g.a.useForm(),a=Object(j.a)(i,1)[0];return Object(h.jsxs)(g.a,{form:a,name:"videoRecordingForm",onFinish:t,initialValues:{quality:c.Q480},children:[Object(h.jsx)(g.a.Item,{label:"File name",name:"filename",rules:[{required:!0,message:"\u0412\u0432\u0435\u0434\u0456\u0442\u044c \u043d\u0430\u0437\u0432\u0443 \u0432\u0456\u0434\u0435\u043e\u0444\u0430\u0439\u043b\u0443"}],children:Object(h.jsx)(p.a,{placeholder:"\u0406\u043c'\u044f \u0432\u0456\u0434\u0435\u043e\u0444\u0430\u0439\u043b\u0443",style:{width:400}})}),Object(h.jsx)(g.a.Item,{label:"Quality",name:"quality",children:Object(h.jsxs)(u.a,{style:{width:120},children:[Object(h.jsx)(A,{value:c.Q720,children:"740"}),Object(h.jsx)(A,{value:c.Q480,children:"480"}),Object(h.jsx)(A,{value:c.Q240,children:"240"})]})}),Object(h.jsx)(g.a.Item,{children:Object(h.jsxs)(v.a,{justify:"space-between",children:[Object(h.jsx)(y.a,{xs:11,children:Object(h.jsx)(b.a,{type:"default",onClick:n,block:!0,children:"Cancel"})}),Object(h.jsx)(y.a,{xs:11,children:Object(h.jsx)(b.a,{type:"primary",htmlType:"submit",block:!0,children:"Submit"})})]})})]})},H=function(){var e=Object(i.useContext)(m),t=e.dispatch,n=e.globalState,c=Object(i.useState)(!1),a=Object(j.a)(c,2),r=a[0],s=a[1],l=Object(o.f)(),d=w(l.search),u=function(){s(!1)};return Object(h.jsxs)("div",{children:[n.isRecording?Object(h.jsx)(U,{onStopRecording:function(){(function(e){var t=e.userId;return C.a.get("".concat(k,"/stop_record?id=").concat(t))})({userId:d}).then((function(){t({isRecording:!1})}))}}):Object(h.jsx)(b.a,{type:"primary",icon:Object(h.jsx)(F.a,{}),onClick:function(){console.log("click"),s(!0)},size:"large",disabled:!n.isStartedPreview,children:"\u041f\u043e\u0447\u0430\u0442\u0438 \u0437\u0430\u043f\u0438\u0441"}),Object(h.jsx)(O.a,{title:"\u0412\u0456\u0434\u0435\u043e\u0437\u0430\u043f\u0438\u0441",centered:!0,visible:r,footer:null,onCancel:u,destroyOnClose:!0,children:Object(h.jsx)(J,{onSubmit:function(e){console.log("data",e),function(e){var t=e.userId,n=e.resolution,c=e.filename;C.a.post("".concat(k,"/start_record?id=").concat(t),JSON.stringify({resolution:n,filename:c}))}({userId:d,resolution:e.quality,filename:e.filename}),t({isRecording:!0}),s(!1)},onCancel:u})})]})},K=function(){return Object(h.jsxs)("div",{children:[Object(h.jsx)(E,{}),Object(h.jsx)(T,{}),Object(h.jsx)(H,{}),Object(h.jsx)(Q,{})]})},L=function(){return Object(h.jsx)(l.a,{children:Object(h.jsx)(o.c,{children:Object(h.jsx)(o.a,{exact:!0,path:"/",component:K})})})},V=(n(252),r.a.Header),_=r.a.Sider,D=r.a.Content,G=function(){return Object(h.jsxs)(r.a,{children:[Object(h.jsxs)(V,{className:"header",children:[Object(h.jsx)("div",{className:"logo"}),"Header"]}),Object(h.jsxs)(r.a,{className:"site-layout",children:[Object(h.jsx)(_,{width:200,className:"site-layout-background",style:{overflow:"auto",height:"calc(100vh - 64px)",position:"fixed",bottom:0,left:0},children:Object(h.jsxs)(s.a,{mode:"inline",defaultSelectedKeys:["1"],defaultOpenKeys:["sub1"],children:[Object(h.jsx)(s.a.Item,{children:"\u041c\u043e\u043d\u0456\u0442\u043e\u0440\u0438\u043d\u0433"},"1"),Object(h.jsx)(s.a.Item,{children:"\u0412\u0456\u0434\u0435\u043e\u0442\u0440\u0430\u043d\u0441\u043b\u044f\u0446\u0456\u044f"},"2"),Object(h.jsx)(s.a.Item,{children:"\u041c\u0435\u0434\u0456\u0430\u0444\u0430\u0439\u043b\u0438"},"3"),Object(h.jsx)(s.a.Item,{children:"\u041d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u043d\u043d\u044f"},"4")]})}),Object(h.jsx)(r.a,{style:{padding:"0 24px 24px",marginLeft:"200px"},children:Object(h.jsx)(D,{className:"site-layout-background",style:{padding:24,margin:0},children:Object(h.jsx)(L,{})})})]})]})},W=n(24),X=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,269)).then((function(t){var n=t.getCLS,c=t.getFID,i=t.getFCP,a=t.getLCP,r=t.getTTFB;n(e),c(e),i(e),a(e),r(e)}))};n.n(W).a.render(Object(h.jsx)(a.a.StrictMode,{children:Object(h.jsx)(f,{children:Object(h.jsx)(G,{})})}),document.getElementById("root")),X()}},[[253,1,2]]]);
//# sourceMappingURL=main.fbb26d2f.chunk.js.map